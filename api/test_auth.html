<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste do Sistema de Autentica√ß√£o</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #005a8b;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .response {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .token-display {
            background: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste do Sistema de Autentica√ß√£o SaaS</h1>
    
    <!-- REGISTRO DE NOVO CLIENTE -->
    <div class="container">
        <h2>1Ô∏è‚É£ Registro de Novo Cliente</h2>
        <form id="registerForm">
            <div class="form-group">
                <label>Nome:</label>
                <input type="text" id="reg_name" value="Jo√£o Silva" required>
            </div>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="reg_email" value="joao@teste.com" required>
            </div>
            <div class="form-group">
                <label>Empresa:</label>
                <input type="text" id="reg_company" value="Empresa Teste LTDA" required>
            </div>
            <div class="form-group">
                <label>Telefone:</label>
                <input type="text" id="reg_phone" value="(11) 99999-9999" required>
            </div>
            <div class="form-group">
                <label>Plano:</label>
                <select id="reg_plan" required>
                    <option value="basic">Basic (R$ 29/m√™s)</option>
                    <option value="premium">Premium (R$ 59/m√™s)</option>
                    <option value="enterprise">Enterprise (R$ 99/m√™s)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Mensagem (opcional):</label>
                <textarea id="reg_message" placeholder="Conte um pouco sobre seu neg√≥cio..."></textarea>
            </div>
            <button type="submit">üìù Registrar Cliente</button>
        </form>
        <div id="registerResponse"></div>
    </div>
    
    <!-- LOGIN -->
    <div class="container">
        <h2>2Ô∏è‚É£ Login</h2>
        <form id="loginForm">
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="login_email" value="luisfboff@hotmail.com" required>
            </div>
            <div class="form-group">
                <label>Senha:</label>
                <input type="password" id="login_password" value="Poker2025!" required>
            </div>
            <button type="submit">üîê Fazer Login</button>
        </form>
        <div id="loginResponse"></div>
        <div id="tokenDisplay" class="token-display" style="display: none;">
            <strong>Token JWT:</strong><br>
            <span id="tokenValue"></span>
        </div>
    </div>
    
    <!-- VERIFICAR TOKEN -->
    <div class="container">
        <h2>3Ô∏è‚É£ Verificar Token</h2>
        <button onclick="verifyToken()">üîç Verificar Token</button>
        <button onclick="getProfile()">üë§ Obter Perfil</button>
        <div id="verifyResponse"></div>
    </div>
    
    <!-- TESTAR SESS√ïES -->
    <div class="container">
        <h2>4Ô∏è‚É£ Testar APIs de Sess√£o</h2>
        <button onclick="getSessions()">üìã Listar Sess√µes</button>
        <button onclick="createSession()">‚ûï Criar Sess√£o Teste</button>
        <button onclick="getPlayers()">üë• Listar Jogadores</button>
        <div id="sessionResponse"></div>
    </div>
    
    <!-- LOGOUT -->
    <div class="container">
        <h2>5Ô∏è‚É£ Logout</h2>
        <button onclick="logout()">üö™ Fazer Logout</button>
        <div id="logoutResponse"></div>
    </div>

    <script>
        let currentToken = null;
        
        // Registro de cliente
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                name: document.getElementById('reg_name').value,
                email: document.getElementById('reg_email').value,
                company: document.getElementById('reg_company').value,
                phone: document.getElementById('reg_phone').value,
                plan: document.getElementById('reg_plan').value,
                message: document.getElementById('reg_message').value
            };
            
            try {
                const response = await fetch('/api/register.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('registerResponse').innerHTML = 
                        `<div class="success">‚úÖ ${result.data.message}</div>
                         <div class="response">${JSON.stringify(result, null, 2)}</div>`;
                } else {
                    document.getElementById('registerResponse').innerHTML = 
                        `<div class="error">‚ùå ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('registerResponse').innerHTML = 
                    `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        });
        
        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                email: document.getElementById('login_email').value,
                password: document.getElementById('login_password').value
            };
            
            try {
                const response = await fetch('/api/auth.php?action=login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    currentToken = result.data.token;
                    document.getElementById('loginResponse').innerHTML = 
                        `<div class="success">‚úÖ Login realizado com sucesso!</div>
                         <div class="response">${JSON.stringify(result, null, 2)}</div>`;
                    
                    document.getElementById('tokenDisplay').style.display = 'block';
                    document.getElementById('tokenValue').textContent = currentToken;
                } else {
                    document.getElementById('loginResponse').innerHTML = 
                        `<div class="error">‚ùå ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('loginResponse').innerHTML = 
                    `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        });
        
        // Verificar token
        async function verifyToken() {
            if (!currentToken) {
                document.getElementById('verifyResponse').innerHTML = 
                    '<div class="error">‚ùå Fa√ßa login primeiro!</div>';
                return;
            }
            
            try {
                const response = await fetch('/api/auth.php?action=verify', {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('verifyResponse').innerHTML = 
                        `<div class="success">‚úÖ Token v√°lido!</div>
                         <div class="response">${JSON.stringify(result, null, 2)}</div>`;
                } else {
                    document.getElementById('verifyResponse').innerHTML = 
                        `<div class="error">‚ùå ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('verifyResponse').innerHTML = 
                    `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        }
        
        // Obter perfil
        async function getProfile() {
            if (!currentToken) {
                document.getElementById('verifyResponse').innerHTML = 
                    '<div class="error">‚ùå Fa√ßa login primeiro!</div>';
                return;
            }
            
            try {
                const response = await fetch('/api/auth.php?action=profile', {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('verifyResponse').innerHTML = 
                        `<div class="success">‚úÖ Perfil obtido com sucesso!</div>
                         <div class="response">${JSON.stringify(result, null, 2)}</div>`;
                } else {
                    document.getElementById('verifyResponse').innerHTML = 
                        `<div class="error">‚ùå ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('verifyResponse').innerHTML = 
                    `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        }
        
        // Listar sess√µes
        async function getSessions() {
            if (!currentToken) {
                document.getElementById('sessionResponse').innerHTML = 
                    '<div class="error">‚ùå Fa√ßa login primeiro!</div>';
                return;
            }
            
            try {
                const response = await fetch('/api/session.php', {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('sessionResponse').innerHTML = 
                        `<div class="success">‚úÖ Sess√µes obtidas com sucesso!</div>
                         <div class="response">${JSON.stringify(result, null, 2)}</div>`;
                } else {
                    document.getElementById('sessionResponse').innerHTML = 
                        `<div class="error">‚ùå ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('sessionResponse').innerHTML = 
                    `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        }
        
        // Criar sess√£o teste
        async function createSession() {
            if (!currentToken) {
                document.getElementById('sessionResponse').innerHTML = 
                    '<div class="error">‚ùå Fa√ßa login primeiro!</div>';
                return;
            }
            
            const sessionData = {
                date: new Date().toISOString().split('T')[0],
                players_data: [
                    { name: "Jo√£o", buyIn: 100, cashOut: 150 },
                    { name: "Maria", buyIn: 100, cashOut: 50 }
                ],
                recommendations: { message: "Sess√£o de teste criada via API" }
            };
            
            try {
                const response = await fetch('/api/session.php', {
                    method: 'POST',
                    headers: { 
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(sessionData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('sessionResponse').innerHTML = 
                        `<div class="success">‚úÖ Sess√£o criada com sucesso!</div>
                         <div class="response">${JSON.stringify(result, null, 2)}</div>`;
                } else {
                    document.getElementById('sessionResponse').innerHTML = 
                        `<div class="error">‚ùå ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('sessionResponse').innerHTML = 
                    `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        }
        
        // Listar jogadores
        async function getPlayers() {
            if (!currentToken) {
                document.getElementById('sessionResponse').innerHTML = 
                    '<div class="error">‚ùå Fa√ßa login primeiro!</div>';
                return;
            }
            
            try {
                const response = await fetch('/api/players.php', {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('sessionResponse').innerHTML = 
                        `<div class="success">‚úÖ Jogadores obtidos com sucesso!</div>
                         <div class="response">${JSON.stringify(result, null, 2)}</div>`;
                } else {
                    document.getElementById('sessionResponse').innerHTML = 
                        `<div class="error">‚ùå ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('sessionResponse').innerHTML = 
                    `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        }
        
        // Logout
        async function logout() {
            if (!currentToken) {
                document.getElementById('logoutResponse').innerHTML = 
                    '<div class="error">‚ùå N√£o h√° sess√£o ativa!</div>';
                return;
            }
            
            try {
                const response = await fetch('/api/auth.php?action=logout', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    currentToken = null;
                    document.getElementById('tokenDisplay').style.display = 'none';
                    document.getElementById('logoutResponse').innerHTML = 
                        `<div class="success">‚úÖ Logout realizado com sucesso!</div>
                         <div class="response">${JSON.stringify(result, null, 2)}</div>`;
                } else {
                    document.getElementById('logoutResponse').innerHTML = 
                        `<div class="error">‚ùå ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('logoutResponse').innerHTML = 
                    `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
